<!doctype html>
<html lang="en">
  <head>
    <title>BlackBear | Journal Post</title>
    <link rel="icon" type="image/png" href="images/icon.png">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="description" content="">
    <meta name="keywords" content="html, css, javascript, jquery">
    <meta name="author" content="">

    <link rel="stylesheet" href="css/vendor/icomoon/style.css">
    <link rel="stylesheet" href="css/vendor/owl.carousel.min.css">
    <link rel="stylesheet" href="css/vendor/animate.min.css">
    <link rel="stylesheet" href="css/vendor/aos.css">
    <link rel="stylesheet" href="css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="css/vendor/jquery.fancybox.min.css">
    <link rel="stylesheet" href="css/style.css">

    <style>
      /* Fondo de video fijo (igual que en index) */
      .video-bg-global { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #000; }
      .video-bg-global video { width: 100%; height: 100%; object-fit: cover; opacity: 0.5; }
      body, .unslate_co--site-wrap, .unslate_co--site-inner, .unslate_co--section, .cover-v1 { background-color: transparent !important; }
      
      /* Ajustes para el contenido del post */
      #post-header.overlay:before { background: rgba(0,0,0,0.6); } /* Oscurecer un poco la portada */
      .post-content { font-size: 1.1rem; line-height: 1.9; color: rgba(255,255,255,0.7); }
      .post-content h2, .post-content h3 { color: #fff; margin-top: 40px; }
      .post-content img { width: 100%; border-radius: 8px; margin: 40px 0; border: 1px solid rgba(255,255,255,0.1); }
      
      /* Navegación y Comentarios */
      .navigation-post p { color: #fff; font-weight: 700; font-size: 1.2rem; margin-top: 5px; }
      .comment-v1 { border-bottom: 1px solid rgba(255,255,255,0.1); padding: 30px 0; list-style: none; }
      .comment-v1 h3 { color: #fff; font-size: 18px; margin-bottom: 5px; }
      .comment-date { font-size: 12px; color: rgba(255,255,255,0.5); text-transform: uppercase; }
      
      /* Formulario en modo oscuro */
      .comment-form-wrap form { background: rgba(255,255,255,0.05); padding: 40px; border-radius: 10px; }
      .form-control { background: rgba(0,0,0,0.5) !important; border: 1px solid rgba(255,255,255,0.2) !important; color: #fff !important; }
      .form-control:focus { border-color: #fff !important; }
      label { color: rgba(255,255,255,0.7); }
    </style>

  </head>
  <body data-spy="scroll" data-target=".site-nav-target" data-offset="200">

    <div class="video-bg-global">
      <video autoplay loop muted playsinline>
        <source src="video/bg.mp4" type="video/mp4">
      </video>
    </div>

    <nav class="unslate_co--site-mobile-menu">
      <div class="close-wrap d-flex">
        <a href="#" class="d-flex ml-auto js-menu-toggle">
          <span class="close-label">Close</span>
          <div class="close-times">
            <span class="bar1"></span>
            <span class="bar2"></span>
          </div>
        </a>
      </div>
      <div class="site-mobile-inner"></div>
    </nav>

    <div class="unslate_co--site-wrap">
      <div class="unslate_co--site-inner">

        <nav class="unslate_co--site-nav site-nav-target">
          <div class="container">
            <div class="row align-items-center justify-content-between text-left">
              <div class="col-md-5 text-right">
                <ul class="site-nav-ul js-clone-nav text-left d-none d-lg-inline-block">
                  <li><a href="index.html#home-section" class="nav-link">Home</a></li>
                  <li><a href="index.html#portfolio-section" class="nav-link">Portfolio</a></li>
                  <li><a href="index.html#about-section" class="nav-link">About</a></li>
                  <li><a href="index.html#services-section" class="nav-link">Services</a></li>
                </ul>
              </div>
              <div class="site-logo pos-absolute">
                <a href="index.html" class="unslate_co--site-logo" style="background: white; padding: 10px 15px; display: inline-block; border-radius: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                  <img src="images/logo.png" alt="BlackBear Logo" style="height: 40px; width: auto; vertical-align: middle;">
                </a>
              </div>
              <div class="col-md-5 text-right text-lg-left">
                <ul class="site-nav-ul js-clone-nav text-left d-none d-lg-inline-block">
                  <li><a href="index.html#skills-section" class="nav-link">Skills</a></li>
                  <li><a href="index.html#testimonial-section" class="nav-link">Testimonial</a></li>
                  <li><a href="index.html#journal-section" class="nav-link active">Journal</a></li>
                  <li><a href="index.html#contact-section" class="nav-link">Contact</a></li>
                </ul>
                <ul class="site-nav-ul-none-onepage text-right d-inline-block d-lg-none">
                  <li><a href="#" class="js-menu-toggle">Menu</a></li>
                </ul>
              </div>
            </div>
          </div>
        </nav>
        <div class="cover-v1 jarallax overlay" id="post-header" style="height: 80vh; background-size: cover; background-position: center;">
          <div class="container">
            <div class="row align-items-center justify-content-center" style="height: 80vh;">
              <div class="col-md-10 text-center" style="position: relative; z-index: 2;">
                <h1 class="heading" id="post-title" style="font-size: 4rem; font-weight: 900;">Cargando...</h1>
                <div class="post-meta subheading" id="post-meta" style="font-size: 1.2rem; color: rgba(255,255,255,0.8);"></div>
              </div>
            </div>
          </div>
          <a href="#blog-content-anchor" class="mouse-wrap smoothscroll" style="z-index: 2;">
            <span class="mouse"><span class="scroll"></span></span>
            <span class="mouse-label">Scroll</span>
          </a>
        </div>

        <div class="unslate_co--section" id="blog-content-anchor">
          <div class="container">
            <div class="row justify-content-center">
              <div class="col-md-8 post-content" id="post-content">
                </div>
            </div>

            <div class="row mt-5 pt-5 navigation-post" style="border-top: 1px solid rgba(255,255,255,0.1);">
              <div class="col-6">
                <a href="#" id="prev-link" class="d-block text-white">
                  <span style="color: #fff; opacity: 0.5;">&larr; Previous Post</span>
                  <p id="prev-title">...</p>
                </a>
              </div>
              <div class="col-6 text-right">
                <a href="#" id="next-link" class="d-block text-white">
                  <span style="color: #fff; opacity: 0.5;">Next Post &rarr;</span>
                  <p id="next-title">...</p>
                </a>
              </div>
            </div>

            <div class="row justify-content-center mt-5 pt-5">
              <div class="col-md-8">
                <div class="section-heading-wrap text-center mb-5">
                  <h2 class="heading-h2 text-center divider" id="comment-count">0 Comments</h2>
                  <span><img src="images/divider.png" alt="divider" width="76"></span>
                </div>
                
                <ul class="comment-list" id="dynamic-comments" style="padding: 0;">
                  </ul>

                <div class="comment-form-wrap pt-5">
                  <h3 class="mb-5 heading-h3 text-center">Leave a comment</h3>
                  <form id="commentForm">
                    <div class="form-group mb-4">
                      <label for="name">Name *</label>
                      <input type="text" class="form-control" id="name" required>
                    </div>
                    <div class="form-group mb-4">
                      <label for="message">Message *</label>
                      <textarea id="message" cols="30" rows="5" class="form-control" required></textarea>
                    </div>
                    <div class="form-group text-center">
                      <input type="submit" value="Post Comment" class="btn btn-outline-pill btn-custom-light" id="submitBtn">
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="unslate_co--footer unslate_co--section" style="background-color: #191919 !important; margin-top: 0;">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-md-7">
            <div class="footer-site-logo">
              <a href="index.html" style="background: white; padding: 8px 12px; display: inline-block; border-radius: 5px; margin-bottom: 20px;">
                <img src="images/logo.png" alt="BlackBear Logo" style="height: 35px; width: auto; vertical-align: middle;">
              </a>
            </div>
            <ul class="footer-site-social">
              <li><a href="#">Facebook</a></li>
              <li><a href="#">Instagram</a></li>
            </ul>
            <p class="site-copyright">
              Copyright &copy;
              <script>document.write(new Date().getFullYear());</script> BlackBear. All rights reserved.
            </p>
          </div>
        </div>
      </div>
    </footer>

    <script src="js/scripts-dist.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
      // --- TUS LINKS (VERIFICA QUE SEAN CORRECTOS) ---
      const URL_POSTS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSBApKJcrHq_sBa2EA4YDyj4GeFrGJ-uH6HzYjGaMbw_tQAIg1Ll6h_w42HbyC2Wuz5uVIDAG0nvbo0/pub?gid=0&single=true&output=csv";
      const URL_COMENTARIOS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSBApKJcrHq_sBa2EA4YDyj4GeFrGJ-uH6HzYjGaMbw_tQAIg1Ll6h_w42HbyC2Wuz5uVIDAG0nvbo0/pub?gid=328009394&single=true&output=csv";
      const URL_APPS_SCRIPT = "https://script.google.com/macros/s/AKfycby1w3WCAhLKvRlppqqnwf4TLyb8yCVcz6KXxnsO-gwsz_wJqb1Dj7a4vbQISltivviqzA/exec";

      const params = new URLSearchParams(window.location.search);
      const postID = parseInt(params.get('id')) || 1;

      // 1. CARGAR POST Y NAVEGACIÓN
      Papa.parse(URL_POSTS, {
        download: true, header: true,
        complete: function(res) {
          const posts = res.data.filter(p => p.ID && p.ID.trim() !== "");
          const post = posts.find(p => p.ID == postID) || posts[0];

          document.getElementById('post-title').innerText = post.Titulo;
          document.getElementById('post-meta').innerText = `By ${post.Autor} • ${post.Fecha} • ${post.TiempoLectura}`;
          document.getElementById('post-content').innerHTML = post.Contenido;
          // Usamos estilo en línea para la imagen de fondo para que sea dinámico
          document.getElementById('post-header').style.backgroundImage = `url('${post.ImagenPortada}')`;

          let idx = posts.findIndex(p => p.ID == postID);
          let prev = posts[(idx - 1 + posts.length) % posts.length];
          let next = posts[(idx + 1) % posts.length];

          document.getElementById('prev-link').href = `blog-single.html?id=${prev.ID}`;
          document.getElementById('prev-title').innerText = prev.Titulo;
          document.getElementById('next-link').href = `blog-single.html?id=${next.ID}`;
          document.getElementById('next-title').innerText = next.Titulo;
        }
      });

      // 2. CARGAR COMENTARIOS
      Papa.parse(URL_COMENTARIOS, {
        download: true, header: true,
        complete: function(res) {
          const comments = res.data.filter(c => c.PostID == postID);
          document.getElementById('comment-count').innerText = `${comments.length} Comments`;
          let html = "";
          comments.reverse().forEach(c => {
            html += `<li class="comment-v1"><h3>${c.Nombre}</h3><div class="comment-date">${c.Fecha}</div><p>${c.Mensaje}</p></li>`;
          });
          document.getElementById('dynamic-comments').innerHTML = html;
        }
      });

      // 3. ENVIAR COMENTARIO
      document.getElementById('commentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const originalText = btn.value;
        btn.value = "Sending...";
        btn.disabled = true;
        btn.style.opacity = "0.5";

        const formData = new URLSearchParams();
        formData.append('postID', postID);
        formData.append('name', document.getElementById('name').value);
        formData.append('message', document.getElementById('message').value);

        fetch(URL_APPS_SCRIPT, {
          method: 'POST',
          mode: 'no-cors',
          body: formData
        }).then(() => {
          alert("¡Gracias! Tu comentario se ha enviado y aparecerá en breve.");
          location.reload();
        }).catch(() => {
          alert("Error al enviar el comentario. Por favor intenta de nuevo.");
          btn.disabled = false;
          btn.value = originalText;
          btn.style.opacity = "1";
        });
      });
    </script>
  </body>
</html>
